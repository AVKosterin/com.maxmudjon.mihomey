<script src='../../../assets/vue.min.js'></script>
<style>
    table.userIdTable {
      background-color: #fff;
      width: 100%;
      text-align: center;
      border-collapse: collapse;

    }
    table.userIdTable td, table.userIdTable th {
      border: 1px solid #AAAAAA;
      padding: 3px 2px;
    }
    table.userIdTable tbody td {
      font-size: 13px;
    }
    table.userIdTable tr:hover {
      background: #D0E4F5;
    }
    table.userIdTable thead {
      background: #a1ffdb;
    }
    table.userIdTable thead th {
      font-size: 15px;
      font-weight: bold;
      color: #000;
      text-align: center;
    }
    table.userIdTable tfoot td {
      font-size: 14px;
    }
    table.userIdTable tfoot .links {
      text-align: right;
    }
    table.userIdTable tfoot .links a{
      display: inline-block;
      background: #a1ffdb;
      color: #FFFFFF;
      padding: 2px 8px;
      border-radius: 5px;
    }

    .newUserDataList {

    }

    .show {
        display: inherit;
    }

    .newUserDataAddButton {
        background: 0 0;
        border: none;
        border-radius: 2px;
        color: #757575;
        position: relative;
        height: 36px;
        margin: 0;
        min-width: 64px;
        padding: 0 16px;
        display: inline-block;
        font-family: "Consolas","Helvetica","Arial",sans-serif;
        font-size: 14px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0;
        overflow: hidden;
        will-change: box-shadow;
        transition: box-shadow .2s cubic-bezier(.4,0,1,1),background-color .2s cubic-bezier(.4,0,.2,1),color .2s cubic-bezier(.4,0,.2,1);
        outline: none;
        cursor: pointer;
        text-decoration: none;
        text-align: center;
        line-height: 36px;
        vertical-align: middle;
    }

    .newUserDataAddButton:hover {
        background-color: rgba(158,158,158,.2);
    }

    .newUserDataAddButton:active {
        background-color: rgba(158,158,158,.4);
    }

    
</style>
<script>

Homey.setTitle('Add users ID');
Homey.emit('getCurrentLockDevice', null, function (err, result) {
  if (err) {
    console.log(err);
    return;
  }
  new Vue({
    el: '#app',
    data: {
      lockSid: result.data.sid,
      users: []
    }
  });


});
</script>

<div id="app">
    <div style="width: 100%">
        <table class="userIdTable" id="userIdTable" >
            <thead>
                <tr>
                    <th>No</th>
                    <th>User Name</th>
                    <th>Finger ID</th>
                    <th>Code ID</th>
                    <th>Card ID</th>
                </tr>
            </thead>
            <tbody>
    
            </tbody>
            <tfoot>
                <tr class="newUserDataList" id="newUserDataList">
                    <td>
                        <input type="number" name="userNumber" id="userNumber" min="0" max="30" style="text-align:center">
                    </td>
                    <td>
                        <input type="text" name="userName" id="userName" size="16" style="text-align:center"/>
                    </td>
                    <td>
                        <input type="number" name="fingerId" id="fingerId" min="65536" max="65556" style="text-align:center">
                    </td>
                    <td>
                        <input type="number" name="codeId" id="codeId" min="131072" max="131102" style="text-align:center">
                    </td>
                    <td>
                        <input type="number" name="cardId" id="cardId" min="196608" max="196638" style="text-align:center">
                    </td>
                </tr>
                <tr id="newUserDataAddButtonTr">
                    <td valign="bottom" align="center" colspan="5">
                        <button class="newUserDataAddButton" id="newUserDataAddButton" onclick="newUserDataAdd()">
                            ADD
                        </button>
                    </td>
               </tr>
            </tfoot>
        </table>
    </div>
</div>

<script>
    function newUserDataAdd() {
        var userNumber = document.getElementById("userNumber").value;
        var userName = document.getElementById("userName").value;
        var fingerId = document.getElementById("fingerId").value;
        var codeId = document.getElementById("codeId").value;
        var cardId = document.getElementById("cardId").value;

        const data = {id:userNumber, user:userName, finger_id:fingerId, code_id:codeId, card_id:cardId}

        document.getElementById("userNumber").value = ''
        document.getElementById("userName").value = ''
        document.getElementById("fingerId").value = ''
        document.getElementById("codeId").value = ''
        document.getElementById("cardId").value = ''

        var tbody = document.getElementById("userIdTable").getElementsByTagName("TBODY")[0];
        var row = document.createElement("TR");
        tbody.appendChild(row);

        var tdUserNumber = document.createElement("TD");
        var tdUserName = document.createElement("TD");
        var tdFingerId = document.createElement("TD");
        var tdCodeId = document.createElement("TD");
        var tdCardId = document.createElement("TD");

        row.appendChild(tdUserNumber);
        row.appendChild(tdUserName);
        row.appendChild(tdFingerId);
        row.appendChild(tdCodeId);
        row.appendChild(tdCardId);

        tdUserNumber.innerHTML = userNumber;
        tdUserName.innerHTML = userName;
        tdFingerId.innerHTML = fingerId;
        tdCodeId.innerHTML = codeId;
        tdCardId.innerHTML = cardId;

        getDataFromTable('userIdTable');
    }

    function getDataFromTable(tbl) {
        var tblData = "";
        var tblArr = new Array();
        var userData = new Array();
        tblLength = document.getElementById(tbl).rows.length;
        for(i=0; i<tblLength; i++){
            tblData = "";
            for(j=0; j<document.getElementById(tbl).rows[i].cells.length; j++){
                  tblData += document.getElementById(tbl).rows[i].cells[j].innerHTML + ",";
            }
            tblData = tblData.substring(0, tblData.length-1)
            if (tblData.length < 100) {
                tblArr[i] = tblData.split(",");
            }
        }
        for (i=1; i<tblArr.length; i++) {
            console.log(tblArr[i])
            var data = {'id':tblArr[i][0],'name':tblArr[i][1],'finger_id':tblArr[i][2],'code_id':tblArr[i][3],'card_id':tblArr[i][4]}
            userData.push(data)
        }
        
        Homey.emit('getCurrentLockDevice', null, function (err, result) {
          if (err) {
            console.log(err);
            return;
          }
          console.log(userData);
          

          Homey.emit('lockUsersID', {'sid': result.data.sid, 'users': userData}, function (err, result) {
            if(err){console.log(err); return;}
          });
        })
    }

</script>